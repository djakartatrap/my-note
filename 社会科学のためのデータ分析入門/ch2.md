# 第2章 因果効果
## 2-3 因果効果と反事実

因果効果の定量化は、事実(factual)と反事実(counterfactual)を比較し、その違いを数値化すること。

### 反事実とは
実際に起きたこと(＝事実、実際に実施した施策等)に対して、注目している条件が異なった場合に起きていたであろう事

#### 実験例
履歴書の例で言えば、「企業が採用において人種差別をしているかどうか？」を推定するために、「白人と黒人の人種の違いで、企業からの連絡の有無に影響を与えているか？」という実験を企画したとする。
その場合、いかにも白人女性らしい名前(ex:アリソン)の履歴書と全く同じ内容の履歴書を、いかにも黒人女性らしい名前(ex:ラキーシャ)で送る事で、企業から連絡をもらったかどうか？の結果の違いを人種別に集計する、という実験を行う事を考える。
その際、同じ企業に、全く同じ内容の履歴書を、別々の名前で送りつける事になるが、そうしてしまうと企業に「おかしいな・・」と思われかねないので、実際には、同じ内容の履歴書を、黒人風名前で送るのはA社、白人風名前で送るのはB社と分けた。

厳密な意味では、同じ会社に、アリソンとラキーシャの履歴書(全く同じ内容)を送るべきだが、企業におかしいと思われては実験そのものが出来ないので、止む無く別の会社に送っている。

このように、本来はアリソンとしての履歴書を送っている(＝事実)のであれば、ラキーシャとしての履歴書も送るべきだが、実際は実施できなかった(＝反事実)。

因果推定では、このような反事実が必ず起き、___因果推論の根本問題___ としてつきまとう。反事実の結果を観察出来ない限り、厳密な因果推定はできない。


それぞれの観察 $i$ に対して、2値のトリートメント $T_i$ の因果効果は、2つの潜在的結果の差である $Y_i(1) - Y_i(0)$ で定義できる。
因果推論の根本問題は、2つの潜在的結果のうち、実際に観察できる結果はどちらか1つだけ、という事である。

## 2-4 ランダム化比較試験(RCT:Randomized Controlled Trial)

### 定義
トリートメントグループ、コントロールグループをランダムに選び出して、それぞれのグループの結果の差を、実施したトリートメントの効果が生んだ差とする試験。
トリートメントの反事実の結果推定量として、コントロール群の結果を使い、またその逆も然り。
トリートメントグループの反事実グループとしてコントロール群を使えるのは、
- ランダム抽出しているから
- 個の結果の反事実の推定(履歴書の例で言えば、アリソンの履歴書を出した企業にラキーシャ名義でも送った場合の連絡の有無を推定する事)は不可能だが、「集団」で考えると、無作為抽出をしているのだから、トリートメント以外の属性値の平均は両グループで一致していると考えられるので、「集団の平均値の差＝トリートメントの効果」と見て良い

### 値の定義
- 標本平均トリートメント効果(sample average treatment effect : SATE)
	- 標本内における個人レベルのトリートメント効果の平均

$$ \begin{aligned}
\text{SATE} & = 1/n \sum_{\mathclap{i=1}}^n \{Y_i(1) - Y_i(0)\}
\end{aligned}
$$

- $Y_i(1)$ : 個体 $i$のトリートメント実施した後の数値
- $Y_i(0)$ : 個体 $i$のトリートメントを実施して __いない__ 場合の数値

$Y_i(0)$は反事実であるので、実際はコントロールグループの数値を使う。

### RCTの強みと弱み
#### 強み
- 内的妥当性を上げる事ができる手法である

##### 内的妥当性とは
その Trial で、仮定している因果関係が成立しているかどうかの妥当性。
RCTをせずに Trial をするよりも、RCTでのTrialの方が精度が上がるのは、感覚的にも理解しやすいよね。

#### 弱み
- 外的妥当性に欠く場合がある

##### 外的妥当性とは
行った Trial が、どの程度一般化できているのか？という妥当性。
(行った試験の結果が一般的にも言えるのか？の保証度合い)

##### 外的妥当性が低くなる要因
- 無作為抽出した標本が、実は無作為ではなく偏っていた
	- 標本として選んだ被験者が、一般公募で募ったため、一般的な集団よりも比較的その試験分野に興味のある人に偏ってしまう
	- → __標本選択のバイアス__
- 実際の環境とは異なる環境で試験をしてしまった場合
	- 本来興味のある被験者の行動は、屋外で行われるものなのに、それを閉鎖された実験室で行ってもらった、等

#### ホーソン効果
被験者が、研究者に観察されている事を知っているために、異なる振る舞いをする現象


## 2-5 観察研究
RCTのように研究者が被験者にトリートメントを行う事が難しい状況の場合、この「観察研究」が行われる。
例えば、「自治体の条例で最低賃金を上げると、失業率はあがるのか？」を見極める場合、研究者が自治体に依頼してランダムに被験者を選び出して最低賃金を上げて・・・という操作は不可能。
では、そこで行われる観察研究とはどういうものなのか？を以降で事例解説

### 2.5.1 最低賃金と失業率

アメリカにニュージャージー州(以降NJ)では、実際の政策として 4.25ドルから 5.05ドルに引き上げられた。このことが、NJでの失業率にどのような影響を与えているのかを調べるためにはは、__NJで最低賃金が引き上げられなかった場合(＝反事実)の失業率を推定する必要がある。しかもRCT手法ではなく。__

#### 打開策 ＝ 横断的比較デザイン(cross-section comparison design)
最低賃金が引き上げられず、かつ、NJの状況と似た州の失業率に注目する。
本書では、NJ州と似た環境にある州として、ペンシルベニア州(PA)が選定された。

このような手法は、cross-section comparison design と呼ばれ、ここではNJ州をトリートメントグループ、PAをコントロールグループと見立てていることになる。

#### 最低賃金上昇の結果変数
今回扱うデータでは、最低賃金の上昇が影響を及ぼす失業関連の結果変数として、「常勤労働者割合」に着目する。
経済学では「最低賃金が上昇すると、人件費があがり、それを埋め合わせるように、常勤労働者をパートタイム労働者に置き換える」という動きがあると考えられているので、「常勤労働者割合」で因果効果を推定する。
実際に推定量を確認すると、NJの方が4.8ポイントほど高かった。
つまり、最低賃金の引き上げが、常勤雇用率を下げる方に働くとは言い難い。

### 2.5.2 交絡バイアス
トリートメント変数と結果変数の両方に対して作用をする因子を、__交絡因子(confounder)__ という。
前述の最低賃金(トリートメント変数)と常勤雇用率(結果変数)について、交絡因子の例を考える。
#### 交絡因子の例
実はNJの方ではスキルの低い人が従事できる競合産業が存在するが、PAでは存在しない、と仮定する。この競合産業がある場合、最低賃金の引き上げがなくても、スキルが低い人を繋ぎ止めようとして常勤雇用率が増えるかもしれない。
そうなると、いくら最低賃金引き上げ効果を常勤雇用率に見ようとしても、邪魔をされて正しく推定できない事になる。

#### 交絡バイアスの一種、選択バイアス
交絡バイアスの中で、例えば、対象者が自らの意志でトリートメントグループに入るような事がある場合の事を、__選択バイアス(selection bias)__ という。
トリートメントグループに入る事を自ら選ぶ＝能動的な態度である、という事なので、その時点で、コントロールグループとの意識の差があることになる。
つまり、トリートメントグループとコントロールグループの間には、本来「トリートメントを受けた・受けていない」という事以外の属性は、ピッタリ一致していなければならないが、そうではない可能性がある、という事になる。

#### 交絡バイアスを可能な限り排除する方法＝統計的コントロール
統計的コントロールにはいくつかの方法がある。
- 細分類化(subclassification)
	- 交絡の疑いがある因子を用いて、一段細かく分類をし、トリートメントグループとコントロールグループにおいて同じ分類同士で比較をする

### 2.5.3 事前・事後の比較と差の差分法
- __縦断的データ(longitudinal data)__
	- 同じユニットに対して長期間にわたって繰り返し測定を行ったデータ
	- 別名
		- __パネルデータ(panel data)__
		- __クロスセクション・データ(横断的データ、cross-section data)__

縦断的データがある場合に使える分析手法はとして、__事前・事後の比較デザイン(before-and-after design)__ があるよ。
前述の最低賃金と雇用率の比較においては、NJとPAの比較をするのではなく、最低賃金が引き上げられる前と後のNJのデータを使って比較する事が、この手法にあたる。

#### 事前事後の比較分析
- 利点
	- グループ(ユニット)特有の交絡因子が一定に保たれる点
		- 同じNJで、事前事後を見れば、NJ内にある交絡因子は一定に保たれるので調整できる
- 欠点
	- 時間とともに変化する交絡因子があると、推定結果にバイアスが生じる
		- 例；地域経済に上向きの __時間傾向(time trend)__ があって、賃金と雇用が改善している場合

#### 差の差分法
- 差の差分法(Difference-In-Difference; DiD)とは
	- トリートメントグループに対する標本平均トリートメント効果を、以下の推定値で求める方法

$$
\text{DiD推定値} = (\bar{Y}_\text{事後トリートメント} - \bar{Y}_\text{事前トリートメント}) - (\bar{Y}_\text{事後コントロール} - \bar{Y}_\text{事前コントロール})
$$

##### 差の差分法がうまくいかない場合
- トリートメントグループの時間傾向と、コントロールグループの時間傾向が並行しない場合
	- 厳密には確かめようないけどね・・・
 	- でも、雇用割合の例で言えば、NJの雇用割合とPAの雇用割合を、対象期間以前(最低賃金引き上げよりも前)に、充分な期間のデータがあれば、NJとPAのデータが並行する性質があるのかどうかは確認できるよね


## 2.6 1変数の記述統計量

### 2.6.2 標準偏差

の前に。

#### 2乗平均平方根(root mean square; RMS)
$$\begin{aligned}
\text{RMS} & = \sqrt{\text{エントリーの2乗の平均}} \\
& = \sqrt{\frac{1}{n} \sum_{i=1}^n{x_i^2}}
\end{aligned}
$$

からの。

#### 標準偏差
$$
\begin{aligned}
\text{標準偏差} & = \\
& = \sqrt{\frac{1}{n} \sum_{i=1}^{n}{(x_i - \bar{x})^2} }
\end{aligned}
$$

## まとめ

|手法|概要|メリット|デメリット|
|:-:|:-|:-|:-|
|ランダム化比較試験(RCT))|トリートメントの割当をランダム化して、トリートメントを受けたかどうか以外の特徴(観察されるもの・されないもののいずれも)が、平均的に等しいと見なせる手法|トリートメントとコントロールの違いは、トリートメントを受けたかどうかだけと考える事ができるので、トリートメントとコントロールの単純比較だけでOK|外的妥当性に欠ける|
|観察研究|直接的な介入は行わない手法。つまり、テストとコントロールの比較という話ではない。比較対象として妥当なグループを選ぶ。|外的妥当性に優れている。|内的妥当性に欠ける。|
|細分類化(層別分析)|交絡因子がある場合に、その因子自体で分類して分析する手法|交絡因子の影響を排除する事ができる|層別分析の結果が、全体の結果と必ずしも一致するわけではないので、全体に対するアウトカムが欲しい場合には使えない|
|事前・事後の比較|同じユニットに対してトリートメント前後の時期で結果変数の差を比較する|時間とともに変化しない交絡因子であれば、無効化できる|時間とともに変化する交絡因子は排除できない。また、時間傾向(time trend)があると、本来の因果が見えなくなってしまう。|
|差の差分(DiD)|トリートメントグループの事前事後の差から、コントロールグループの事前事後の差を引く手法|事前事後の比較手法のデメリットである「時間傾向の影響」を削除できる。|トリートメントグループとコントロールグループの時間傾向(time trend)が一致している事が前提。しかも、実際時間傾向が一致していそうかどうかを推察するには、トリートメントグループとコントロールグループのある程度長い期間の事前データを見て、興味ある指標が並行して動いているかを確認して推察するしかない|
