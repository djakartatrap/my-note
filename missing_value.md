# 欠損値の処理

手法は以下の3つ。
- 捨てる
- 置換する
- 補完する

## 1. 捨てる
データが大量にあり、欠損値が少数の場合

### 削除の手法
- リストワイズ法
  - レコード内に欠損値が1つでもあれば、データとして削除(＝リストから削除)
- ペアワイズ法
  - 算出したい指標(例：相関係数)に使うデータのうち、片方のデータが無いような場合に、その算出指標(相関係数)を出す時のみ、無視する。他の処理(単純集計)等の際には普通に使う。

## 2. 置換する
置換方法は以下の3つ
- 最頻値
- 中央値
- 平均値
- 回帰推定値

## 3. 補間する
時系列データにおける欠損をする手法。

# 欠損値を扱う際の注意点
欠損値の生じ方が「完全にランダム」でない場合は特殊な補完方法が必要。
- 完全情報最尤推定法
  - TODO: あとで調べる
- 多重代入法
  - TODO: あとで調べる

# データの欠損状態について
そもそも、データが欠損している状態を幾つかの場合に分けて理解を深める。  
その際、以下のようなデータフレームがあるとして、説明する。  
|Index|カラムX|カラムY|
|:-:|:-|:-|
|1   | 53   | 160 |
|2   | 64   | 154 |
|3   | NA  |  148 |
|4   | 48  | 152  |


## Missing Completely At Random : MCAR
どのデータ項目においても、完全にランダムにデータが欠損している状態。  
カラムX、カラムYというデータを持つレコードを複数持つデータフレームがある場合、XもYも、とにかく完全ランダムにデータが欠損している状態。  

## Missing At Random : MAR
カラムXを「体重」と想像しましょう。  
例えば、体重が多い人は恥ずかしがって計測を拒否する、みたいな事は想像に易い。これは、カラムXのデータの大きさによって、データ欠損が誘導されるパターンになる。  
こういった、「自身のカラムデータの影響で、自身のカラムに欠損が生じる」状態を、MARと言う。  
(自身の状態に依存はしているが、欠損レコードが現れるのは自身のカラム内では依存するが、カラム同士の依存はないので”ランダム”という意図か？)

## Missing Not At Random : MNAR
カラムXが、カラムYの欠損に影響をしたり、その逆もまた然り、と言った状態をMNARと言う。  
お互いのデータ項目が依存しているので、全然ランダム欠損にはならないのでこの名前がついてる。

# 欠損値の補完方法をまとめてみる
|手法|方法について|メリット|デメリット|MCAR|MAR|MNAR|
|:--|:--|:--|:--|:--|:--|:--|
|リストワイズ|欠損があるレコードをリストから削除。なかったことにする。|手軽|データ量が減る|△|×|×|
|ペアワイズ|算出したい指標に使う複数データのうちの1つが無い場合、その指標算出時のみ、無視する。他の処理のとk時には普通に使う。| 手軽  | データが減る(リストワイズよりはマシ) | △ | × | × |
|代表値で置き換え | 最頻値、中央値、平均値のいずれかの値を、全欠損箇所に入れる(すべての欠損を同じ数値で置き換える)| 手軽 | 穴はなくなるが、穴埋めするデータに意味はなく、補完の意義が薄い | △ | × | × |
|回帰推定値で置き換え|何らかの回帰モデルを作成し、推測値で置き換える|比較的意義のある穴埋めになる|項目が多いと手間|○|△|△|
|完全情報最尤推定値で穴埋め|EMアルゴリズムを用いて欠損値を推定、補完する。(Full-Information Maximum Likelihood: FIML)|   |   | ◎  | ◎ | △ |
|多重代入法| Multiple Imputation: MI|   |   | ◎ | ◎ | △|
